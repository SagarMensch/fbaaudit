// Enhanced Invoice Review - ANALYTICS & REPORTING DASHBOARD
// Pure reporting - NO workflow actions

import React, { useState, useMemo } from 'react';
import MasterDataService from '../services/masterDataService';
import { Invoice, InvoiceStatus } from '../types';

type ApprovalStage = 'L1_ANALYST' | 'L2_MANAGER' | 'L3_FINAL' | 'COMPLETED';

interface WorkflowStage {
    stage: ApprovalStage;
    approver: string;
    role: string;
    status: 'PENDING' | 'APPROVED' | 'REJECTED';
    timestamp?: string;
    comments?: string;
}

interface EnhancedInvoiceReviewProps {
    currentUser?: { name: string; role: string };
    invoices: Invoice[]; // Receive from App.tsx for uniformity
}
status: inv.status === 'SUBMITTED' ? 'PENDING' : 'APPROVED',
    timestamp: inv.status !== 'SUBMITTED' ? inv.submittedDate : undefined
            },
{
    stage: 'L2_MANAGER',
        approver: 'Zeya Kapoor',
            role: 'FINANCE MANAGER',
                status: inv.status === 'APPROVED' || inv.status === 'PAID' ? 'APPROVED' :
                    inv.status === 'UNDER_REVIEW' ? 'PENDING' :
                        inv.status === 'SUBMITTED' ? 'PENDING' : 'PENDING',
                    timestamp: inv.status === 'APPROVED' || inv.status === 'PAID' ? inv.submittedDate : undefined
},
{
    stage: 'L3_FINAL',
        approver: 'Director Finance',
            role: 'FINAL APPROVER',
                status: inv.status === 'PAID' ? 'APPROVED' : 'PENDING',
                    timestamp: inv.status === 'PAID' ? inv.submittedDate : undefined
}
        ] as WorkflowStage[]
    }));
}, [allInvoices]);

// Get my pending approvals
const myPendingApprovals = useMemo(() => {
    return invoicesWithWorkflow.filter(inv => {
        const myStage = inv.workflow.find((w: WorkflowStage) => w.approver === currentUser);
        return myStage && myStage.status === 'PENDING';
    });
}, [invoicesWithWorkflow, currentUser]);

// Calculate pipeline metrics
const pipelineMetrics = useMemo(() => {
    const submitted = invoicesWithWorkflow.filter(inv => inv.status === 'SUBMITTED').length;
    const underReview = invoicesWithWorkflow.filter(inv => inv.status === 'UNDER_REVIEW').length;
    const approved = invoicesWithWorkflow.filter(inv => inv.status === 'APPROVED').length;
    const rejected = invoicesWithWorkflow.filter(inv => inv.status === 'REJECTED').length;
    const paid = invoicesWithWorkflow.filter(inv => inv.status === 'PAID').length;

    return { submitted, underReview, approved, rejected, paid };
}, [invoicesWithWorkflow]);

// Filter invoices
const filteredInvoices = useMemo(() => {
    let filtered = invoicesWithWorkflow;

    // Filter by my pending
    if (filterStatus === 'my_pending') {
        filtered = myPendingApprovals;
    } else if (filterStatus !== 'all') {
        filtered = filtered.filter(inv => inv.status === filterStatus);
    }

    // Search filter
    if (searchQuery) {
        filtered = filtered.filter(invoice =>
            invoice.invoiceNumber?.toLowerCase().includes(searchQuery.toLowerCase()) ||
            invoice.lrNumber?.toLowerCase().includes(searchQuery.toLowerCase()) ||
            invoice.supplierName?.toLowerCase().includes(searchQuery.toLowerCase())
        );
    }

    return filtered;
}, [invoicesWithWorkflow, filterStatus, searchQuery, myPendingApprovals]);

// Handle approve - actually update the invoice
const handleApprove = (invoice: any) => {
    try {
        // Update invoice status
        const updatedInvoice = {
            ...invoice,
            status: 'APPROVED' as InvoiceStatus,
            approvedBy: currentUser,
            approvedDate: new Date().toISOString().split('T')[0]
        };

        InvoiceStorageService.updateInvoice(invoice.id, updatedInvoice);
        alert(`Invoice ${invoice.invoiceNumber} APPROVED by ${currentUser}`);
        setSelectedInvoice(null);

        // Force refresh
        window.location.reload();
    } catch (error) {
        console.error('Error approving invoice:', error);
        alert('Error approving invoice');
    }
};

// Handle reject - actually update the invoice
const handleReject = (invoice: any) => {
    const reason = prompt('Enter rejection reason:');
    if (reason) {
        try {
            // Update invoice status
            const updatedInvoice = {
                ...invoice,
                status: 'REJECTED' as InvoiceStatus,
                rejectedBy: currentUser,
                rejectedDate: new Date().toISOString().split('T')[0],
                rejectionReason: reason
            };

            InvoiceStorageService.updateInvoice(invoice.id, updatedInvoice);
            alert(`Invoice ${invoice.invoiceNumber} REJECTED by ${currentUser}\nReason: ${reason}`);
            setSelectedInvoice(null);

            // Force refresh
            window.location.reload();
        } catch (error) {
            console.error('Error rejecting invoice:', error);
            alert('Error rejecting invoice');
        }
    }
};

// Handle send back
const handleSendBack = (invoice: any) => {
    const reason = prompt('Enter reason for sending back:');
    if (reason) {
        alert(`Invoice ${invoice.invoiceNumber} sent back by ${currentUser}\nReason: ${reason}`);
        setSelectedInvoice(null);
    }
};

// Handle add comment
const handleAddComment = () => {
    if (comment.trim()) {
        alert(`Comment added by ${currentUser}: ${comment}`);
        setComment('');
        setShowCommentBox(false);
    }
};

return (
    <div className="h-full flex flex-col font-sans p-8 overflow-hidden bg-[#F5F5F5]">
        {/* Header */}
        <div className="flex justify-between items-start mb-6 flex-shrink-0">
            <div>
                <h2 className="text-2xl font-bold text-gray-900 tracking-tight">INVOICE REVIEW</h2>
                <p className="text-sm text-gray-700 mt-1 font-medium">Logged in as: {currentUser}</p>
            </div>
            <div className="flex gap-3">
                {myPendingApprovals.length > 0 && (
                    <div className="px-4 py-2 bg-[#8B4513] text-white text-sm font-bold border-2 border-[#654321]">
                        {myPendingApprovals.length} PENDING YOUR APPROVAL
                    </div>
                )}
            </div>
        </div>

        {/* Pipeline Overview - SOLID COLORS, NO ICONS */}
        <div className="mb-6 flex-shrink-0">
            <h3 className="text-sm font-bold text-gray-900 uppercase mb-3">APPROVAL PIPELINE</h3>
            <div className="grid grid-cols-5 gap-3">
                <div className="bg-[#1E3A8A] text-white border-2 border-[#1E40AF] p-4">
                    <div className="text-xs font-bold uppercase mb-2">NEW</div>
                    <div className="text-3xl font-bold">{pipelineMetrics.submitted}</div>
                    <div className="text-xs mt-1 opacity-90">L1 Pending</div>
                </div>

                <div className="bg-[#8B4513] text-white border-2 border-[#654321] p-4">
                    <div className="text-xs font-bold uppercase mb-2">UNDER REVIEW</div>
                    <div className="text-3xl font-bold">{pipelineMetrics.underReview}</div>
                    <div className="text-xs mt-1 opacity-90">L2 Pending</div>
                </div>

                <div className="bg-[#2D5016] text-white border-2 border-[#1F3A0F] p-4">
                    <div className="text-xs font-bold uppercase mb-2">APPROVED</div>
                    <div className="text-3xl font-bold">{pipelineMetrics.approved}</div>
                    <div className="text-xs mt-1 opacity-90">L3 Pending</div>
                </div>

                <div className="bg-[#991B1B] text-white border-2 border-[#7F1D1D] p-4">
                    <div className="text-xs font-bold uppercase mb-2">REJECTED</div>
                    <div className="text-3xl font-bold">{pipelineMetrics.rejected}</div>
                    <div className="text-xs mt-1 opacity-90">Declined</div>
                </div>

                <div className="bg-[#374151] text-white border-2 border-[#1F2937] p-4">
                    <div className="text-xs font-bold uppercase mb-2">PAID</div>
                    <div className="text-3xl font-bold">{pipelineMetrics.paid}</div>
                    <div className="text-xs mt-1 opacity-90">Completed</div>
                </div>
            </div>
        </div>

        {/* Filters and Search */}
        <div className="flex items-center gap-3 mb-4 flex-shrink-0">
            <div className="relative flex-1">
                <input
                    type="text"
                    placeholder="Search by invoice #, LR #, or vendor..."
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    className="w-full px-4 py-2 border-2 border-gray-900 text-sm font-medium focus:outline-none"
                />
            </div>
            <select
                value={filterStatus}
                onChange={(e) => setFilterStatus(e.target.value as any)}
                className="px-4 py-2 border-2 border-gray-900 text-sm font-bold focus:outline-none"
            >
                <option value="my_pending">MY PENDING ({myPendingApprovals.length})</option>
                <option value="all">ALL INVOICES</option>
                <option value="SUBMITTED">SUBMITTED</option>
                <option value="UNDER_REVIEW">UNDER REVIEW</option>
                <option value="APPROVED">APPROVED</option>
                <option value="REJECTED">REJECTED</option>
                <option value="PAID">PAID</option>
            </select>
        </div>

        {/* Invoice Table */}
        <div className="flex-1 overflow-auto bg-white border-2 border-gray-900">
            <table className="w-full">
                <thead className="bg-gray-200 border-b-2 border-gray-900 sticky top-0">
                    <tr>
                        <th className="px-4 py-3 text-left text-xs font-bold text-gray-900 uppercase border-r border-gray-400">INVOICE #</th>
                        <th className="px-4 py-3 text-left text-xs font-bold text-gray-900 uppercase border-r border-gray-400">SUPPLIER</th>
                        <th className="px-4 py-3 text-left text-xs font-bold text-gray-900 uppercase border-r border-gray-400">LR NUMBER</th>
                        <th className="px-4 py-3 text-left text-xs font-bold text-gray-900 uppercase border-r border-gray-400">ROUTE</th>
                        <th className="px-4 py-3 text-right text-xs font-bold text-gray-900 uppercase border-r border-gray-400">AMOUNT</th>
                        <th className="px-4 py-3 text-left text-xs font-bold text-gray-900 uppercase border-r border-gray-400">CURRENT STAGE</th>
                        <th className="px-4 py-3 text-right text-xs font-bold text-gray-900 uppercase">ACTIONS</th>
                    </tr>
                </thead>
                <tbody className="divide-y divide-gray-300">
                    {filteredInvoices.length === 0 ? (
                        <tr>
                            <td colSpan={7} className="px-4 py-12 text-center text-gray-600">
                                <p className="text-lg font-bold">NO INVOICES FOUND</p>
                                <p className="text-sm mt-1">
                                    {filterStatus === 'my_pending'
                                        ? 'You have no pending approvals'
                                        : 'No invoices match your filters'}
                                </p>
                            </td>
                        </tr>
                    ) : (
                        filteredInvoices.map((invoice) => {
                            const currentStage = invoice.workflow.find((w: WorkflowStage) => w.status === 'PENDING');
                            const isMyPending = currentStage && currentStage.approver === currentUser;

                            return (
                                <tr
                                    key={invoice.id}
                                    className={`hover:bg-gray-100 ${isMyPending ? 'bg-yellow-50' : ''}`}
                                >
                                    <td className="px-4 py-3 text-sm font-mono font-bold text-gray-900 border-r border-gray-200">{invoice.invoiceNumber}</td>
                                    <td className="px-4 py-3 text-sm font-bold text-gray-900 border-r border-gray-200">{invoice.supplierName}</td>
                                    <td className="px-4 py-3 text-sm font-mono text-gray-700 border-r border-gray-200">{invoice.lrNumber}</td>
                                    <td className="px-4 py-3 text-sm text-gray-700 border-r border-gray-200">
                                        {invoice.origin} → {invoice.destination}
                                    </td>
                                    <td className="px-4 py-3 text-sm text-right font-bold text-gray-900 border-r border-gray-200">
                                        ₹{invoice.totalAmount.toLocaleString()}
                                    </td>
                                    <td className="px-4 py-3 text-sm font-bold border-r border-gray-200">
                                        <div className={isMyPending ? 'text-[#8B4513]' : 'text-gray-700'}>
                                            {currentStage ? currentStage.approver : 'Completed'}
                                        </div>
                                        {isMyPending && (
                                            <div className="text-xs text-[#8B4513] font-bold mt-1">■ YOUR ACTION REQUIRED</div>
                                        )}
                                    </td>
                                    <td className="px-4 py-3 text-right">
                                        <button
                                            onClick={() => setSelectedInvoice(invoice)}
                                            className="px-3 py-1 bg-[#1E3A8A] text-white font-bold text-xs hover:bg-[#1E40AF] border-2 border-[#1E40AF]"
                                        >
                                            VIEW DETAILS
                                        </button>
                                    </td>
                                </tr>
                            );
                        })
                    )}
                </tbody>
            </table>
        </div>

        {/* Detailed Invoice Modal - ONLY OPENS ON CLICK */}
        {selectedInvoice && (
            <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
                <div className="bg-white w-full max-w-6xl max-h-[90vh] overflow-auto border-4 border-gray-900">
                    {/* Modal Header */}
                    <div className="px-6 py-4 bg-gray-200 border-b-4 border-gray-900 flex justify-between items-center sticky top-0">
                        <div>
                            <h3 className="text-lg font-bold text-gray-900">INVOICE: {selectedInvoice.invoiceNumber}</h3>
                            <p className="text-sm text-gray-700 mt-1 font-bold">Detailed Analysis & Approval</p>
                        </div>
                        <button
                            onClick={() => setSelectedInvoice(null)}
                            className="text-gray-900 hover:text-red-700 font-bold text-2xl"
                        >
                            ✕
                        </button>
                    </div>

                    {/* Modal Content */}
                    <div className="p-6">
                        {/* Workflow Timeline - SOLID COLORS, NO ICONS */}
                        <div className="mb-6 bg-gray-100 border-2 border-gray-900 p-4">
                            <h4 className="text-sm font-bold text-gray-900 uppercase mb-4">APPROVAL WORKFLOW</h4>
                            <div className="flex items-center justify-between gap-4">
                                {selectedInvoice.workflow.map((stage: WorkflowStage, idx: number) => (
                                    <React.Fragment key={stage.stage}>
                                        <div className="flex-1">
                                            <div className={`p-3 border-4 ${stage.status === 'APPROVED' ? 'bg-[#2D5016] border-[#1F3A0F] text-white' :
                                                stage.status === 'PENDING' && stage.approver === currentUser ? 'bg-[#8B4513] border-[#654321] text-white' :
                                                    stage.status === 'PENDING' ? 'bg-white border-[#8B4513] text-gray-900' :
                                                        'bg-gray-200 border-gray-400 text-gray-600'
                                                }`}>
                                                <div className="text-xs font-bold uppercase mb-1">{stage.role}</div>
                                                <div className="text-sm font-bold">{stage.approver}</div>
                                                <div className="text-xs mt-1 font-bold">
                                                    {stage.status === 'APPROVED' ? `■ APPROVED ${stage.timestamp}` :
                                                        stage.status === 'PENDING' && stage.approver === currentUser ? '■ YOUR TURN' :
                                                            stage.status === 'PENDING' ? '□ PENDING' : '□ WAITING'}
                                                </div>
                                            </div>
                                        </div>
                                        {idx < selectedInvoice.workflow.length - 1 && (
                                            <div className="text-2xl font-bold text-gray-400">▶</div>
                                        )}
                                    </React.Fragment>
                                ))}
                            </div>
                        </div>

                        {/* Basic Info Grid */}
                        <div className="grid grid-cols-4 gap-4 mb-6">
                            <div className="border-2 border-gray-900 p-3 bg-gray-50">
                                <p className="text-xs font-bold text-gray-600 uppercase mb-1">VENDOR</p>
                                <p className="text-sm font-bold text-gray-900">{selectedInvoice.supplierName}</p>
                            </div>
                            <div className="border-2 border-gray-900 p-3 bg-gray-50">
                                <p className="text-xs font-bold text-gray-600 uppercase mb-1">LR NUMBER</p>
                                <p className="text-sm font-mono font-bold text-gray-900">{selectedInvoice.lrNumber}</p>
                            </div>
                            <div className="border-2 border-gray-900 p-3 bg-gray-50">
                                <p className="text-xs font-bold text-gray-600 uppercase mb-1">ROUTE</p>
                                <p className="text-sm font-bold text-gray-900">{selectedInvoice.origin} → {selectedInvoice.destination}</p>
                            </div>
                            <div className="border-2 border-gray-900 p-3 bg-gray-50">
                                <p className="text-xs font-bold text-gray-600 uppercase mb-1">WEIGHT</p>
                                <p className="text-sm font-bold text-gray-900">{selectedInvoice.weight} kg</p>
                            </div>
                        </div>

                        {/* Charge Breakdown */}
                        <div className="mb-6">
                            <h4 className="text-sm font-bold text-gray-900 uppercase mb-3">CHARGE BREAKDOWN</h4>
                            <table className="w-full border-4 border-gray-900">
                                <thead className="bg-gray-200">
                                    <tr>
                                        <th className="px-4 py-2 text-left text-xs font-bold text-gray-900 uppercase border-r-2 border-gray-900">CHARGE TYPE</th>
                                        <th className="px-4 py-2 text-right text-xs font-bold text-gray-900 uppercase border-r-2 border-gray-900">AMOUNT</th>
                                        <th className="px-4 py-2 text-right text-xs font-bold text-gray-900 uppercase border-r-2 border-gray-900">VERIFIED</th>
                                        <th className="px-4 py-2 text-center text-xs font-bold text-gray-900 uppercase">STATUS</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y-2 divide-gray-900">
                                    <tr className="border-t-2 border-gray-900">
                                        <td className="px-4 py-2 text-sm font-bold text-gray-900 border-r-2 border-gray-900">Base Freight</td>
                                        <td className="px-4 py-2 text-sm text-right font-bold text-gray-900 border-r-2 border-gray-900">₹{selectedInvoice.baseAmount.toLocaleString()}</td>
                                        <td className="px-4 py-2 text-sm text-right text-gray-700 border-r-2 border-gray-900">₹{selectedInvoice.baseAmount.toLocaleString()}</td>
                                        <td className="px-4 py-2 text-sm text-center">
                                            <span className="px-2 py-1 text-xs font-bold bg-[#2D5016] text-white border-2 border-[#1F3A0F]">
                                                MATCH
                                            </span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td className="px-4 py-2 text-sm font-bold text-gray-900 border-r-2 border-gray-900">Fuel Surcharge (15%)</td>
                                        <td className="px-4 py-2 text-sm text-right font-bold text-gray-900 border-r-2 border-gray-900">₹{selectedInvoice.fuelSurcharge.toLocaleString()}</td>
                                        <td className="px-4 py-2 text-sm text-right text-gray-700 border-r-2 border-gray-900">₹{selectedInvoice.fuelSurcharge.toLocaleString()}</td>
                                        <td className="px-4 py-2 text-sm text-center">
                                            <span className="px-2 py-1 text-xs font-bold bg-[#2D5016] text-white border-2 border-[#1F3A0F]">
                                                MATCH
                                            </span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td className="px-4 py-2 text-sm font-bold text-gray-900 border-r-2 border-gray-900">GST (18%)</td>
                                        <td className="px-4 py-2 text-sm text-right font-bold text-gray-900 border-r-2 border-gray-900">₹{selectedInvoice.gst.toLocaleString()}</td>
                                        <td className="px-4 py-2 text-sm text-right text-gray-700 border-r-2 border-gray-900">₹{selectedInvoice.gst.toLocaleString()}</td>
                                        <td className="px-4 py-2 text-sm text-center">
                                            <span className="px-2 py-1 text-xs font-bold bg-[#2D5016] text-white border-2 border-[#1F3A0F]">
                                                MATCH
                                            </span>
                                        </td>
                                    </tr>
                                    <tr className="bg-gray-200 border-t-4 border-gray-900">
                                        <td className="px-4 py-3 text-sm font-bold text-gray-900 border-r-2 border-gray-900">TOTAL</td>
                                        <td className="px-4 py-3 text-sm text-right font-bold text-gray-900 border-r-2 border-gray-900">₹{selectedInvoice.totalAmount.toLocaleString()}</td>
                                        <td className="px-4 py-3 text-sm text-right font-bold text-gray-900 border-r-2 border-gray-900">₹{selectedInvoice.totalAmount.toLocaleString()}</td>
                                        <td className="px-4 py-3 text-sm text-center">
                                            <span className="px-2 py-1 text-xs font-bold bg-[#2D5016] text-white border-2 border-[#1F3A0F]">
                                                VERIFIED
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        {/* Document Links - NO ICONS, GEOMETRIC SHAPES ONLY */}
                        <div className="mb-6">
                            <h4 className="text-sm font-bold text-gray-900 uppercase mb-3">SUPPORTING DOCUMENTS</h4>
                            <div className="grid grid-cols-3 gap-3">
                                <a
                                    href="/sample-documents/invoice-sample.pdf"
                                    target="_blank"
                                    className="border-4 border-gray-900 p-3 hover:bg-gray-100 bg-white"
                                >
                                    <div className="text-xs font-bold text-gray-900 mb-2">■ INVOICE PDF</div>
                                    <p className="text-xs text-gray-600 font-bold">CLICK TO VIEW</p>
                                </a>
                                <a
                                    href="/sample-documents/lr-copy-sample.pdf"
                                    target="_blank"
                                    className="border-4 border-gray-900 p-3 hover:bg-gray-100 bg-white"
                                >
                                    <div className="text-xs font-bold text-gray-900 mb-2">■ LR COPY</div>
                                    <p className="text-xs text-gray-600 font-bold">CLICK TO VIEW</p>
                                </a>
                                <a
                                    href={selectedInvoice.podStatus === 'UPLOADED' ? '/sample-documents/pod-sample.pdf' : '#'}
                                    target={selectedInvoice.podStatus === 'UPLOADED' ? '_blank' : undefined}
                                    className={`border-4 p-3 ${selectedInvoice.podStatus === 'UPLOADED'
                                        ? 'border-gray-900 hover:bg-gray-100 bg-white'
                                        : 'border-[#8B4513] bg-[#FFF8DC]'
                                        }`}
                                >
                                    <div className="text-xs font-bold text-gray-900 mb-2">
                                        {selectedInvoice.podStatus === 'UPLOADED' ? '■ POD' : '□ POD'}
                                    </div>
                                    <p className="text-xs text-gray-600 font-bold">
                                        {selectedInvoice.podStatus === 'UPLOADED' ? 'CLICK TO VIEW' : 'PENDING UPLOAD'}
                                    </p>
                                </a>
                            </div>
                        </div>

                        {/* Comment Box */}
                        {showCommentBox && (
                            <div className="mb-6 border-4 border-gray-900 p-4 bg-gray-50">
                                <h4 className="text-sm font-bold text-gray-900 uppercase mb-3">ADD COMMENT</h4>
                                <textarea
                                    value={comment}
                                    onChange={(e) => setComment(e.target.value)}
                                    className="w-full border-2 border-gray-900 p-2 text-sm font-medium"
                                    rows={3}
                                    placeholder="Enter your comment here..."
                                />
                                <div className="flex gap-2 mt-2">
                                    <button
                                        onClick={handleAddComment}
                                        className="px-4 py-2 bg-[#1E3A8A] text-white font-bold text-sm hover:bg-[#1E40AF] border-2 border-[#1E40AF]"
                                    >
                                        SUBMIT COMMENT
                                    </button>
                                    <button
                                        onClick={() => {
                                            setShowCommentBox(false);
                                            setComment('');
                                        }}
                                        className="px-4 py-2 border-2 border-gray-900 text-gray-900 hover:bg-gray-100 font-bold text-sm"
                                    >
                                        CANCEL
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Action Buttons - NO ICONS, GEOMETRIC SHAPES ONLY */}
                        <div className="flex gap-3 pt-4 border-t-4 border-gray-900">
                            {(() => {
                                const myStage = selectedInvoice.workflow.find((w: WorkflowStage) => w.approver === currentUser);
                                const isMyPending = myStage && myStage.status === 'PENDING';

                                if (!isMyPending) {
                                    return (
                                        <div className="flex-1 text-center py-3 bg-gray-200 border-2 border-gray-400 text-gray-600 font-bold">
                                            NOT YOUR TURN TO APPROVE
                                        </div>
                                    );
                                }

                                return (
                                    <>
                                        <button
                                            onClick={() => handleApprove(selectedInvoice)}
                                            className="flex-1 px-4 py-3 bg-[#2D5016] text-white hover:bg-[#1F3A0F] font-bold text-sm border-4 border-[#1F3A0F]"
                                        >
                                            ✓ APPROVE
                                        </button>
                                        <button
                                            onClick={() => handleReject(selectedInvoice)}
                                            className="flex-1 px-4 py-3 bg-[#991B1B] text-white hover:bg-[#7F1D1D] font-bold text-sm border-4 border-[#7F1D1D]"
                                        >
                                            ✗ REJECT
                                        </button>
                                        <button
                                            onClick={() => handleSendBack(selectedInvoice)}
                                            className="px-6 py-3 border-4 border-gray-900 text-gray-900 hover:bg-gray-100 font-bold text-sm"
                                        >
                                            ◄ SEND BACK
                                        </button>
                                        <button
                                            onClick={() => setShowCommentBox(!showCommentBox)}
                                            className="px-6 py-3 border-4 border-gray-900 text-gray-900 hover:bg-gray-100 font-bold text-sm"
                                        >
                                            ▣ COMMENT
                                        </button>
                                        <button
                                            onClick={() => {
                                                const input = document.createElement('input');
                                                input.type = 'file';
                                                input.accept = '.pdf,.jpg,.png';
                                                input.onchange = (e: any) => {
                                                    const file = e.target.files[0];
                                                    if (file) {
                                                        alert(`File attached: ${file.name}`);
                                                    }
                                                };
                                                input.click();
                                            }}
                                            className="px-6 py-3 border-4 border-gray-900 text-gray-900 hover:bg-gray-100 font-bold text-sm"
                                        >
                                            ▤ ATTACH
                                        </button>
                                    </>
                                );
                            })()}
                        </div>
                    </div>
                </div>
            </div>
        )}
    </div>
);
};

export default EnhancedInvoiceReview;
