{
    "schema_version": "1.0",
    "document_type": "INVOICE",
    "description": "Freight/logistics invoice schema with validation rules",
    "fields": {
        "invoice_number": {
            "type": "string",
            "required": true,
            "label": "Invoice Number",
            "description": "Unique invoice identifier",
            "extraction_patterns": [
                "Invoice\\s*(?:No|Number|#|:)\\s*[:\\s]?\\s*([A-Z0-9\\-\\/]+)",
                "Bill\\s*(?:No|Number)\\s*[:\\s]?\\s*([A-Z0-9\\-\\/]+)",
                "Tax\\s*Invoice\\s*(?:No)?\\s*[:\\s]?\\s*([A-Z0-9\\-\\/]+)"
            ],
            "validation": {
                "min_length": 3,
                "max_length": 50,
                "pattern": "^[A-Z0-9\\-\\/]+$"
            }
        },
        "invoice_date": {
            "type": "date",
            "required": true,
            "label": "Invoice Date",
            "formats": [
                "DD-MM-YYYY",
                "DD/MM/YYYY",
                "YYYY-MM-DD",
                "DD-MMM-YYYY"
            ],
            "extraction_patterns": [
                "Invoice\\s*Date[:\\s]*(\\d{1,2}[-\\/\\.]\\d{1,2}[-\\/\\.]\\d{2,4})",
                "Date[:\\s]*(\\d{1,2}[-\\/\\.]\\d{1,2}[-\\/\\.]\\d{2,4})",
                "Dated[:\\s]*(\\d{1,2}[-\\/\\.]\\d{1,2}[-\\/\\.]\\d{2,4})"
            ],
            "validation": {
                "not_future": true,
                "not_older_than_days": 730
            }
        },
        "vendor": {
            "type": "object",
            "required": true,
            "fields": {
                "name": {
                    "type": "string",
                    "required": true,
                    "label": "Vendor Name",
                    "extraction_patterns": [
                        "^([A-Z][A-Za-z\\s&]+(?:Ltd|Limited|Pvt|Private))",
                        "From[:\\s]+([A-Z][A-Za-z\\s&]+)"
                    ]
                },
                "gstin": {
                    "type": "string",
                    "required": false,
                    "label": "GSTIN",
                    "extraction_patterns": [
                        "GSTIN[:\\s]*(\\d{2}[A-Z]{5}\\d{4}[A-Z]{1}[A-Z\\d]{1}[Z]{1}[A-Z\\d]{1})"
                    ],
                    "validation": {
                        "pattern": "^\\d{2}[A-Z]{5}\\d{4}[A-Z]{1}[A-Z\\d]{1}[Z]{1}[A-Z\\d]{1}$",
                        "length": 15
                    }
                },
                "pan": {
                    "type": "string",
                    "required": false,
                    "label": "PAN",
                    "extraction_patterns": [
                        "PAN[:\\s]*([A-Z]{5}\\d{4}[A-Z]{1})"
                    ],
                    "validation": {
                        "pattern": "^[A-Z]{5}\\d{4}[A-Z]{1}$",
                        "length": 10
                    }
                },
                "address": {
                    "type": "string",
                    "required": false
                }
            }
        },
        "shipment": {
            "type": "object",
            "required": false,
            "fields": {
                "lr_number": {
                    "type": "string",
                    "label": "LR/Docket Number",
                    "extraction_patterns": [
                        "LR\\s*(?:No|Number)?[:\\s]*([A-Z0-9\\-]+)",
                        "Docket\\s*(?:No)?[:\\s]*([A-Z0-9\\-]+)"
                    ]
                },
                "vehicle_number": {
                    "type": "string",
                    "label": "Vehicle Number",
                    "extraction_patterns": [
                        "Vehicle\\s*(?:No)?[:\\s]*([A-Z]{2}\\d{1,2}[A-Z]{1,2}\\d{4})"
                    ],
                    "validation": {
                        "pattern": "^[A-Z]{2}\\d{1,2}[A-Z]{1,2}\\d{4}$"
                    }
                },
                "origin": {
                    "type": "string",
                    "label": "Origin",
                    "extraction_patterns": [
                        "From[:\\s]+([A-Za-z\\s]+)",
                        "Origin[:\\s]+([A-Za-z\\s]+)"
                    ]
                },
                "destination": {
                    "type": "string",
                    "label": "Destination",
                    "extraction_patterns": [
                        "To[:\\s]+([A-Za-z\\s]+)",
                        "Destination[:\\s]+([A-Za-z\\s]+)"
                    ]
                },
                "weight_kg": {
                    "type": "number",
                    "label": "Weight (kg)",
                    "extraction_patterns": [
                        "Weight[:\\s]*(\\d+(?:\\.\\d+)?)\\s*(?:kg|KG|Kg)?"
                    ],
                    "validation": {
                        "min": 0,
                        "max": 50000
                    }
                }
            }
        },
        "line_items": {
            "type": "array",
            "required": false,
            "label": "Line Items",
            "item_schema": {
                "description": {
                    "type": "string"
                },
                "quantity": {
                    "type": "number"
                },
                "rate": {
                    "type": "number"
                },
                "amount": {
                    "type": "number"
                }
            }
        },
        "amounts": {
            "type": "object",
            "required": true,
            "fields": {
                "subtotal": {
                    "type": "number",
                    "required": true,
                    "label": "Subtotal/Taxable Amount",
                    "extraction_patterns": [
                        "(?:Sub\\s*Total|Subtotal|Taxable\\s*(?:Value|Amount))[:\\s]*(?:Rs\\.?|₹|INR)?\\s*([\\d,]+\\.?\\d*)"
                    ],
                    "validation": {
                        "min": 0
                    }
                },
                "cgst_amount": {
                    "type": "number",
                    "required": false,
                    "label": "CGST Amount",
                    "extraction_patterns": [
                        "CGST[:\\s@]*\\d*\\.?\\d*%?[:\\s]*(?:Rs\\.?|₹)?\\s*([\\d,]+\\.?\\d*)"
                    ],
                    "validation": {
                        "min": 0
                    }
                },
                "sgst_amount": {
                    "type": "number",
                    "required": false,
                    "label": "SGST Amount",
                    "extraction_patterns": [
                        "SGST[:\\s@]*\\d*\\.?\\d*%?[:\\s]*(?:Rs\\.?|₹)?\\s*([\\d,]+\\.?\\d*)"
                    ],
                    "validation": {
                        "min": 0
                    }
                },
                "igst_amount": {
                    "type": "number",
                    "required": false,
                    "label": "IGST Amount",
                    "extraction_patterns": [
                        "IGST[:\\s@]*\\d*\\.?\\d*%?[:\\s]*(?:Rs\\.?|₹)?\\s*([\\d,]+\\.?\\d*)"
                    ],
                    "validation": {
                        "min": 0
                    }
                },
                "total_tax": {
                    "type": "number",
                    "required": false,
                    "label": "Total Tax",
                    "computed_from": {
                        "formula": "cgst_amount + sgst_amount + igst_amount"
                    }
                },
                "total_amount": {
                    "type": "number",
                    "required": true,
                    "label": "Grand Total",
                    "extraction_patterns": [
                        "(?:Grand\\s*Total|Total\\s*(?:Amount)?|Net\\s*(?:Amount|Payable)|Amount\\s*Payable)[:\\s]*(?:Rs\\.?|₹|INR)?\\s*([\\d,]+\\.?\\d*)"
                    ],
                    "validation": {
                        "min": 0,
                        "must_equal": "subtotal + total_tax"
                    }
                }
            }
        },
        "payment_terms": {
            "type": "string",
            "required": false,
            "label": "Payment Terms",
            "extraction_patterns": [
                "Payment\\s*Terms?[:\\s]*([\\d]+\\s*days?.*)",
                "Due\\s*Date[:\\s]*(.*)"
            ]
        }
    },
    "business_rules": [
        {
            "rule": "total_validation",
            "description": "Total must equal subtotal plus all taxes",
            "validation": "amounts.total_amount == amounts.subtotal + amounts.cgst_amount + amounts.sgst_amount + amounts.igst_amount"
        },
        {
            "rule": "tax_presence",
            "description": "Must have either CGST+SGST or IGST, not both",
            "validation": "(cgst_amount > 0 AND sgst_amount > 0 AND igst_amount == 0) OR (igst_amount > 0 AND cgst_amount == 0 AND sgst_amount == 0)"
        },
        {
            "rule": "gstin_validation",
            "description": "GSTIN first 2 digits should match state from address",
            "validation": "vendor.gstin matches state_code_lookup(vendor.address)"
        }
    ],
    "confidence_thresholds": {
        "overall_minimum": 70.0,
        "critical_fields": {
            "invoice_number": 90.0,
            "amounts.total_amount": 85.0,
            "amounts.subtotal": 85.0,
            "vendor.gstin": 95.0
        },
        "review_threshold": 75.0
    }
}